<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>공휴일·주말 계산기 + 연차 추천기</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f4f4f4; padding: 20px; max-width: 960px; margin: auto; }
    select, button, input { padding: 10px; margin: 5px; border-radius: 6px; border: 1px solid #ccc; }
    .box { background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); padding: 20px; margin-top: 20px; }
    .highlight { color: #d9534f; font-weight: bold; }
    .card { background: #fcfcfc; border-left: 4px solid #2ecc71; margin-bottom: 10px; padding: 10px 15px; border-radius: 6px; }
    .copy-btn, .download-btn, .ics-btn { margin-top: 10px; padding: 8px 12px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .copy-btn:hover, .download-btn:hover, .ics-btn:hover { background: #2c80b4; }
    ul { padding-left: 20px; }
  </style>
</head>
<body>
  <h2>2025 공휴일·주말 계산기 + 연차 추천 + 일정 저장</h2>
  
  <div class="box">
    <label>연도:</label><select id="year"></select>
    <label>월:</label><select id="month"><option value="0">전체 연도</option></select>
    <label>연차 사용:</label><select id="leaveDays">
      <option value="0">선택</option><option value="1">1일</option><option value="2">2일</option><option value="3">3일</option><option value="4">4일</option><option value="5">5일</option>
    </select>
    <label>보유 연차:</label><input type="number" id="totalLeave" value="15" min="1" max="30">
    <button onclick="calculateDays()">계산하기</button>
  </div>

  <div class="box" id="resultBox"></div>
  <div class="box" id="simBox"></div>

  <script>
    const yearSelect = document.getElementById("year");
    const monthSelect = document.getElementById("month");
    const leaveDaysSelect = document.getElementById("leaveDays");
    const totalLeaveInput = document.getElementById("totalLeave");
    const resultBox = document.getElementById("resultBox");
    const simBox = document.getElementById("simBox");

    for (let y = 2024; y <= 2030; y++) {
      yearSelect.innerHTML += `<option value="${y}">${y}년</option>`;
    }
    for (let m = 1; m <= 12; m++) {
      monthSelect.innerHTML += `<option value="${m}">${m}월</option>`;
    }

    function calculateDays() {
      const year = parseInt(yearSelect.value);
      const month = parseInt(monthSelect.value);
      const leaveDays = parseInt(leaveDaysSelect.value);
      const totalLeave = parseInt(totalLeaveInput.value);
      let current = new Date(year, month > 0 ? month - 1 : 0, 1);
      const end = new Date(year, month > 0 ? month : 12, 0);
      let simResults = [];

      while (current <= end) {
        const day = current.getDay();
        const isFri = day === 5, isMon = day === 1;
        if (isFri || isMon) {
          const before = new Date(current);
          const after = new Date(current);
          if (isFri) after.setDate(after.getDate() + 2);
          if (isMon) before.setDate(before.getDate() - 2);
          simResults.push({
            type: isFri ? "금요일 연차" : "월요일 연차",
            range: `${before.toLocaleDateString()} ~ ${after.toLocaleDateString()}`,
            start: before.toISOString(),
            title: isFri ? "금요일 연차 추천" : "월요일 연차 추천"
          });
        }
        current.setDate(current.getDate() + 1);
      }

      resultBox.innerHTML = `<p class='card'><strong>선택 연차:</strong> ${leaveDays}일 | <strong>잔여 연차:</strong> ${totalLeave - leaveDays}일</p>`;

      let simHTML = `<h3>연차 조합 시뮬레이션</h3><ul>`;
      simResults.slice(0, leaveDays).forEach(sim => {
        simHTML += `<li><b>${sim.type}</b>: ${sim.range} <button class='ics-btn' onclick='downloadICS("${sim.title}", "${sim.start}")'>일정 저장</button></li>`;
      });
      simHTML += `</ul><button class='download-btn' onclick='downloadAsImage()'>이미지 저장</button>`;
      simBox.innerHTML = simHTML;
    }

    function downloadAsImage() {
      html2canvas(document.body).then(canvas => {
        const link = document.createElement('a');
        link.download = '연차계산결과.png';
        link.href = canvas.toDataURL();
        link.click();
      });
    }

    function downloadICS(title, start) {
      const dtStart = start.replace(/[-:]/g, '').split('.')[0];
      const ics = `BEGIN:VCALENDAR\nVERSION:2.0\nBEGIN:VEVENT\nSUMMARY:${title}\nDTSTART:${dtStart}\nDTEND:${dtStart}\nEND:VEVENT\nEND:VCALENDAR`;
      const blob = new Blob([ics], {type: 'text/calendar'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `${title}.ics`;
      link.click();
    }
  </script>
</body>
</html>
